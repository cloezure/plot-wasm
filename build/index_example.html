<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>WasmTest</title>
  </head>
  <body>
    <canvas id="canvas0" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas1" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas2" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas3" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas4" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas5" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas6" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas7" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas8" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas9" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas10" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas11" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas12" oncontextmenu="event.preventDefault()"></canvas>
    <script type='text/javascript'>

      let SSE = new EventSource('http://' + '10.16.0.156' + ':' + 3030 + '/get-all-spectrums');

      function base64ToArrayBuffer(base64) {
          let bs = window.atob(base64)
          let len = bs.length
          let bytes = new Uint8Array(len)
          for(let i = 0; i < len; i++) {
              bytes[i] = bs.charCodeAt(i);
          }
          return bytes.buffer;
      }

      var Module = {
          canvas: (function() {
              return document.getElementById('canvas');
          })(),
          onRuntimeInitialized: function() {
              test = Module.cwrap('test', 'number', ['number', 'number'])
              alert('1 + 2 = ' + test(1, 2));
          },

      };


      SSE.onmessage = msg => {
          let buffer = base64ToArrayBuffer(msg.data)
          let view = new DataView(buffer)
       
          let sp = view.getUint32(0, true)
          let rc = view.getUint32(4, true)
          let scs = 8 + 4 * rc

          for (let sidx = 0; sidx < scs; sidx++) {
              let offset = 8 + sidx * scs;
              draw_trace(view.getFloat32(offset, true),
                             view.getFloat32(offset + 4, true),
                             new Float32Array(view.slice(offset + 8, offset + scs)),
                             rc)
          }
      }
      };
      
      
    </script>
    <script async type="text/javascript" src="plot0.js"></script>
    <script async type="text/javascript" src="plot1.js"></script>
    <script async type="text/javascript" src="plot2.js"></script>
    <script async type="text/javascript" src="plot3.js"></script>
    <script async type="text/javascript" src="plot4.js"></script>
    <script async type="text/javascript" src="plot5.js"></script>
    <script async type="text/javascript" src="plot6.js"></script>
    <script async type="text/javascript" src="plot7.js"></script>
    <script async type="text/javascript" src="plot8.js"></script>
    <script async type="text/javascript" src="plot9.js"></script>
    <script async type="text/javascript" src="plot10.js"></script>
    <script async type="text/javascript" src="plot11.js"></script>
    <script async type="text/javascript" src="plot12.js"></script>
  </body>
</html>
